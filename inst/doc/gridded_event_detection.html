<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="AJ Smit" />

<meta name="date" content="2018-07-25" />

<title>Extreme event detection in gridded data</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Extreme event detection in gridded data</h1>
<h4 class="author"><em>AJ Smit</em></h4>
<h4 class="date"><em>2018-07-25</em></h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Because of human-induced climate change, we anticipate that extreme events would occur more frequently and that they would become greater in intensity. Here I address this question by using some gridded SST data, which is the only way that we can assess if this trend is unfolding across large ocean regions. Using the gridded <a href="http://dx.doi.org/10.1175/2007JCLI1824.1">0.25 degree Reynolds OISST</a>, I will find extreme SST events around South Africa data by applying the <code>detect()</code> function pixel-by-pixel. After detecting the events, I will fit a generalised linear model (GLM) to calculate rates of change in some marine heat wave metrics, and then plot the estimated trend.</p>
</div>
<div id="reading-in-the-netcdf" class="section level2">
<h2>Reading in the netCDF</h2>
<p>These instructions assume we start with a netCDF file that contains data for only the region of interest in our study, with all of the daily data in one file. If you start from scratch, it might make sense to rather do the subsetting elsewhere and process the daily netCDF files. If that is the case, see <a href="https://robwschlegel.github.io/heatwaveR/articles/OISST_preparation.html">this vignette</a>.</p>
<p>First, I read in the 0.25 degree <a href="https://www.ncei.noaa.gov/thredds/blended-global/oisst-catalog.html">OISST netCDF file</a>. I save the only variable, <strong>sst</strong>, as a multidimensional array (longitude, latitude and date). To do this, I use the <strong>ncdf4</strong> package. I then construct a list with names and values for each dimension of the SST array. The example data used here cover 93 longitude and 43 latitude steps (i.e. 3999 pixels), and cover 12797 days (1981 to 2016). The names for the three dimensions are simply a list of longitudes, latitudes and dates, which I get directly from the netCDF file. Note that not all netCDF files are created equally, and sometimes vectors of longitudes, latitudes and dates need to be created based on the start values for lat/lon/date in the netCDF, and the ‘steps’ between sequential lats/lons/dates. To determine out how to approach reading in the netCDF file, use the <code>print()</code> function to scrutinise the content of the netCDF.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">nc_open</span>(<span class="st">&quot;/Users/ajsmit/spatial/OISSTv2/daily/OISST-V2-AVHRR_agg.nc&quot;</span>)
<span class="co"># print(nc)</span>
sst &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc, <span class="dt">varid =</span> <span class="st">&quot;sst&quot;</span>) <span class="co"># reads in the only var in netCDF file</span>
<span class="kw">dimnames</span>(sst) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">lon =</span> nc<span class="op">$</span>dim<span class="op">$</span>lon<span class="op">$</span>vals,
                      <span class="dt">lat =</span> nc<span class="op">$</span>dim<span class="op">$</span>lat<span class="op">$</span>vals, 
                      <span class="dt">t =</span> nc<span class="op">$</span>dim<span class="op">$</span>time<span class="op">$</span>vals)</code></pre></div>
<p>Now I take this array of SST data and convert it into a a data frame using <strong>reshape2</strong>’s <code>melt()</code> function. This creates columns named <strong>lon</strong>, <strong>lat</strong> and <strong>t</strong> (the latter is the time vector, with the mandatory name <strong>t</strong>, which is required by <strong>RmarineHeatWave</strong>’s <code>make_whole()</code> and <code>detect()</code> functions). Now each SST value is indexed by a unique combination of <strong>lon</strong>, <strong>lat</strong> and <strong>t</strong>. Notice too how I use the <strong>tibble</strong> package’s <code>as_tibble()</code> function together with <code>melt()</code>, because I like the way that it neatly creates a very readbale data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sst &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">melt</span>(sst, <span class="dt">value.name =</span> <span class="st">&quot;temp&quot;</span>))
sst<span class="op">$</span>t &lt;-<span class="st"> </span><span class="kw">as.Date</span>(sst<span class="op">$</span>t, <span class="dt">origin =</span> <span class="st">'1978-01-01'</span>)</code></pre></div>
<p>Since the data frame of SSTs contains some NAs where seawater temperatures are not available due to the presence of land, I remove all cases with NAs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sst1 &lt;-<span class="st"> </span>sst <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>()
<span class="kw">rm</span>(sst); <span class="kw">rm</span>(nc)</code></pre></div>
</div>
<div id="event-detection" class="section level2">
<h2>Event detection</h2>
<p>Now I make a wrapper function to combine <code>make_whole()</code> and <code>detect()</code>. This increases the ease of use of this function with <strong>plyr</strong>’s <code>ddply()</code> function, but most importantly, it pulls out only the <strong>event</strong> portion of the list of results (i.e. ignoring <strong>clim</strong>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OISST_detect &lt;-<span class="st"> </span><span class="cf">function</span>(dat) {
  dat &lt;-<span class="st"> </span>dat[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]
  start =<span class="st"> &quot;1983-01-01&quot;</span>
  end =<span class="st"> &quot;2012-12-31&quot;</span>
  whole &lt;-<span class="st"> </span><span class="kw">make_whole</span>(dat)
  mhw &lt;-<span class="st"> </span><span class="kw">detect</span>(whole, <span class="dt">climatology_start =</span> start, <span class="dt">climatology_end =</span> end,
                <span class="dt">min_duration =</span> <span class="dv">5</span>, <span class="dt">max_gap =</span> <span class="dv">2</span>, <span class="dt">cold_spells =</span> <span class="ot">FALSE</span>)
  events &lt;-<span class="st"> </span>mhw<span class="op">$</span>event
  <span class="kw">return</span>(events)
  }</code></pre></div>
<p>And now I apply the <code>OISST_detect()</code> function to the SST data and save the results as an intermediate .Rdata file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># it takes a long time...</span>
<span class="kw">system.time</span>(OISST_events &lt;-<span class="st"> </span><span class="kw">ddply</span>(sst1, .(lon, lat), OISST_detect, <span class="dt">.parallel =</span> <span class="ot">TRUE</span>))
 <span class="co">#   user  system elapsed </span>
 <span class="co"># 1862.3   205.9   704.8 </span>
<span class="kw">save</span>(OISST_events, <span class="dt">file =</span> <span class="st">&quot;/Users/ajsmit/spatial/OISSTv2/MHWs/OISST_events.Rdata&quot;</span>)</code></pre></div>
<p>Because I saved the results to a file I can load these rather than rerunning the <code>OISST_detect()</code> function, which takes about 11 minutes to execute on my 4 GHz iMac.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># in case it was calculated and saved earlier, we can load it here now:</span>
<span class="kw">load</span>(<span class="st">&quot;/Users/ajsmit/spatial/OISSTv2/MHWs/OISST_events.Rdata&quot;</span>)</code></pre></div>
</div>
<div id="trend-detection" class="section level2">
<h2>Trend detection</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># summarise the number of unique longitude, latitude and year combination:</span>
event_freq &lt;-<span class="st"> </span>OISST_events <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(date_start)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(lon, lat, year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
<span class="kw">head</span>(event_freq)

<span class="co"># create complete grid for merging with:</span>
sst.grid &lt;-<span class="st"> </span>sst1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(lon, lat, t) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t =</span> lubridate<span class="op">::</span><span class="kw">year</span>(t)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="co"># slow...</span>
<span class="kw">colnames</span>(sst.grid)[<span class="kw">colnames</span>(sst.grid) <span class="op">==</span><span class="st"> 't'</span>] &lt;-<span class="st"> 'year'</span>

<span class="co"># and merge:</span>
OISST_n &lt;-<span class="st"> </span><span class="kw">left_join</span>(sst.grid, event_freq)
OISST_n[<span class="kw">is.na</span>(OISST_n)] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lin_fun &lt;-<span class="st"> </span><span class="cf">function</span>(ev) {
  mod1 &lt;-<span class="st"> </span><span class="kw">glm</span>(n <span class="op">~</span><span class="st"> </span>year, <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>), <span class="dt">data =</span> ev)
  <span class="co"># mod1 &lt;- lm(n ~ year, data = ev)</span>
  tr &lt;-<span class="st"> </span><span class="kw">summary</span>(mod1)<span class="op">$</span>coefficients[<span class="dv">2</span>,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)] <span class="co"># extract slope coefficient and its p-value</span>
  <span class="kw">return</span>(tr)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OISST_nTrend &lt;-<span class="st"> </span><span class="kw">ddply</span>(OISST_n, .(lon, lat), lin_fun)
OISST_nTrend<span class="op">$</span>pval &lt;-<span class="st"> </span><span class="kw">cut</span>(OISST_nTrend[,<span class="dv">4</span>], <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>))
<span class="kw">head</span>(OISST_nTrend)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Coastline of African continent and some borders:
<span class="kw">load</span>(<span class="st">&quot;/Users/ajsmit/Dropbox/repos/Trend_Analysis/graph/africa_coast.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;/Users/ajsmit/Dropbox/repos/Trend_Analysis/graph/africa_borders.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;/Users/ajsmit/Dropbox/repos/Trend_Analysis/graph/south_africa_coast.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;/Users/ajsmit/Dropbox/repos/Trend_Analysis/graph/sa_provinces_new.RData&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(OISST_nTrend, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">fill =</span> <span class="ot">NA</span>,
       <span class="kw">aes</span>(<span class="dt">xmin =</span> lon <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">xmax =</span> lon <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">ymin =</span> lat <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">ymax =</span> lat <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>,
           <span class="dt">colour =</span> OISST_nTrend[,<span class="dv">5</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Estimate), <span class="dt">interpolate =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">name =</span> <span class="st">&quot;Count</span><span class="ch">\n</span><span class="st"> per</span><span class="ch">\n</span><span class="st"> year&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;white&quot;</span>,
                       <span class="dt">low =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">midpoint =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;(0,0.001]&quot;</span>, <span class="st">&quot;(0.001,0.01]&quot;</span>, <span class="st">&quot;(0.01,0.05]&quot;</span>, <span class="st">&quot;(0.05,1]&quot;</span>),
                      <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;firebrick1&quot;</span>, <span class="st">&quot;firebrick2&quot;</span>, <span class="st">&quot;firebrick3&quot;</span>, <span class="st">&quot;white&quot;</span>),
                      <span class="dt">name =</span> <span class="st">&quot;p-value&quot;</span>, <span class="dt">guide =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> south_africa_coast, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), 
               <span class="dt">colour =</span> <span class="ot">NA</span>, <span class="dt">fill =</span> <span class="st">&quot;grey80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> africa_borders, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), 
            <span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> south_africa_coast, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">12.12</span>, <span class="fl">35.12</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">26.88</span>, <span class="op">-</span><span class="fl">37.38</span>), <span class="dt">expand =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()
<span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="st">&quot;README-grid-example1.png&quot;</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="fl">3.2</span>)

<span class="kw">ggplot</span>(OISST_nTrend, <span class="kw">aes</span>(lon, lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> pval), <span class="dt">interpolate =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;(0,0.001]&quot;</span>, <span class="st">&quot;(0.001,0.01]&quot;</span>, <span class="st">&quot;(0.01,0.05]&quot;</span>,
                               <span class="st">&quot;(0.05,0.1]&quot;</span>, <span class="st">&quot;(0.1,0.5]&quot;</span>, <span class="st">&quot;(0.5,1]&quot;</span>),
                    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;grey20&quot;</span>, <span class="st">&quot;grey40&quot;</span>,
                               <span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;grey90&quot;</span>, <span class="st">&quot;white&quot;</span>),
                    <span class="dt">name =</span> <span class="st">&quot;p-value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> south_africa_coast, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), 
               <span class="dt">colour =</span> <span class="ot">NA</span>, <span class="dt">fill =</span> <span class="st">&quot;grey80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> africa_borders, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), 
            <span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> south_africa_coast, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), 
               <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">12.12</span>, <span class="fl">35.12</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">26.88</span>, <span class="op">-</span><span class="fl">37.38</span>), <span class="dt">expand =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()
<span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="st">&quot;README-grid-example2.png&quot;</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="fl">3.2</span>)</code></pre></div>
<!-- ```{r, echo = FALSE, include = TRUE, out.width = "580px", fig.cap = "**Figure 1.** Plot of marine heat waves detected in the 0.25 degree Reynold's OISST around South Africa, showing the increase in frequency of marine heat waves within the Agulhas Current. Outlined pixels indicate that the trend is significant at p < 0.05."} -->
<!-- knitr::include_graphics("README-grid-example1.png") -->
<!-- ``` -->
<!-- ```{r, echo = FALSE, include = TRUE, out.width = "580px", fig.cap = "**Figure 2.** Plot of marine heat waves found in the 0.25 degree Reynold's OISST around South Africa, showing the significance of the detected trend in frequency of marine heat waves within the Agulhas Current."} -->
<!-- knitr::include_graphics("README-grid-example2.png") -->
<!-- ``` -->
<!-- ![](README-grid-example1.png){width=100%} -->
<!-- ![](README-grid-example2.png){width=100%} -->
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
